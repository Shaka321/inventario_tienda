{% extends "base_tw.html" %}
{% block title %}Finanzas ¬∑ Reposici√≥n de Stock{% endblock %}

{% block head %}
<link rel="preconnect" href="https://rsms.me/">
<link rel="stylesheet" href="https://rsms.me/inter/inter.css">
<style>
  :root { font-family: 'Inter', sans-serif; }
  @supports (font-variation-settings: normal) { :root { font-family: 'Inter var', sans-serif; } }
</style>
{% endblock %}

{% block content %}
<!-- FULL-BLEED para ocupar 100% del ancho visual -->
<div class="relative left-1/2 right-1/2 -ml-[50vw] -mr-[50vw] w-screen">
  <div class="antialiased bg-black text-slate-300 min-h-[calc(100vh-7rem)] py-6">
    <div class="grid grid-cols-12 mx-auto gap-2 sm:gap-4 md:gap-6 lg:gap-10 xl:gap-14 max-w-7xl px-2">

      <!-- CONTENT (100% ancho sin sidebar) -->
      <main id="content" class="bg-white/10 col-span-12 rounded-lg p-6 ring-1 ring-white/10">

        <!-- Encabezado -->
        <div class="flex items-center justify-between mb-6">
          <h1 class="text-2xl md:text-3xl font-bold bg-gradient-to-br from-white via-white/60 to-transparent bg-clip-text text-transparent">
            üì• Reposici√≥n de Stock
          </h1>
          <a href="{{ url_for('main.fin_panel') }}"
             class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-slate-100 font-semibold inline-flex items-center gap-2 ring-1 ring-white/10">
            ‚¨ÖÔ∏è <span>Volver a Finanzas</span>
          </a>
        </div>

        <!-- Formulario -->
        <form action="{{ url_for('reposicion') }}" method="POST"
              class="grid md:grid-cols-3 gap-4 rounded-lg ring-1 ring-white/10 p-4 bg-white/5">

          <!-- Producto -->
          <div class="md:col-span-2">
            <label class="block text-sm font-semibold mb-1 text-slate-200">Producto</label>
            <select name="producto_repos" required
                    class="w-full rounded-lg bg-black/30 text-slate-200 border border-white/10 focus:outline-none focus:ring-2 focus:ring-indigo-500">
              <option value="">-- Selecciona un producto --</option>
              {% for p in productos %}
                <option value="{{ p[0] }}">{{ p[0] }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Cantidad -->
          <div>
            <label class="block text-sm font-semibold mb-1 text-slate-200">Cantidad a reponer (unidades)</label>
            <input type="number" name="cantidad_repos" id="cantidad_repos" min="1" required
                   class="w-full rounded-lg bg-black/30 text-slate-200 border border-white/10 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
          </div>

          <!-- Costo unitario -->
          <div>
            <label class="block text-sm font-semibold mb-1 text-slate-200">Costo unitario (opcional)</label>
            <input type="number" step="0.01" min="0" name="costo_unit" id="costo_unit" placeholder="Ej. 12.50"
                   class="w-full rounded-lg bg-black/30 text-slate-200 border border-white/10 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <p class="text-xs text-slate-400 mt-1">
              Si lo indicas, el reporte mostrar√° el valor total de esta reposici√≥n.
            </p>
          </div>

          <!-- Proveedor (opcional) -->
          <div>
            <label class="block text-sm font-semibold mb-1 text-slate-200">Proveedor (opcional)</label>
            <input type="text" name="proveedor" id="proveedor" placeholder="Nombre del proveedor"
                   class="w-full rounded-lg bg-black/30 text-slate-200 border border-white/10 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
          </div>

          <!-- Valor total (solo display) -->
          <div class="md:col-span-1">
            <label class="block text-sm font-semibold mb-1 text-slate-200">Valor total (auto)</label>
            <input type="text" id="valor_total_mostrado" readonly placeholder="‚Äî"
                   class="w-full rounded-lg bg-black/50 text-slate-300 border border-white/10 px-3 py-2">
          </div>

          <!-- Botones -->
          <div class="md:col-span-3 flex flex-wrap items-center gap-3">
            <button class="px-4 py-2 bg-indigo-600/90 hover:bg-indigo-500 text-white rounded-lg font-semibold">
              Guardar reposici√≥n
            </button>
            <a href="{{ url_for('main.fin_panel') }}"
               class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 ring-1 ring-white/10 font-semibold text-slate-100">
              Cancelar
            </a>
          </div>
        </form>

      </main>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  (function(){
    const cant = document.getElementById('cantidad_repos');
    const costo = document.getElementById('costo_unit');
    const total = document.getElementById('valor_total_mostrado');

    function calc(){
      const q = parseFloat(cant.value) || 0;
      const cu = parseFloat(costo.value) || 0;
      const v = q * cu;
      total.value = (q && cu) ? v.toFixed(2) : '';
    }

    cant?.addEventListener('input', calc);
    costo?.addEventListener('input', calc);
  })();
</script>
{% endblock %}
